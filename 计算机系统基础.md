![[Pasted image 20230526164653.png]]# 绪论

——这门课讲什么：计算机是如何生成和运行可执行文件的

## 现代计算机系统的层次
![[Pasted image 20230519203016.png]]

——语言发展是一个不断抽象的过程

![[Pasted image 20230519203118.png]]
——ISA是处于软件和硬件之间的接口

![[Pasted image 20230519203435.png]]

- 编译器和汇编器的目标程序由机器级代码组成
- 操作系统通过指令直接对硬件进行编程控制

——**ISA是对硬件的抽象**

### 什么是ISA
—— instruction set architecture   指令集体结构，又叫指令系统
它是一种规约（Specification） 规定了**软件如何使用硬件**
	- 可执行指令的集合，包括指令格式、操作种类以及每种操作对应的操作数的相应规定
	- 指令可以接受的操作数的类型
	- 操作数所能存放的**寄存器组的结构**（包括寄存器的名称、编号、长度和用途）
	- 操作数所能存放的**存储空间的大小**和**编址方式**
	- 操作数在存储空间存放时按照大端还是小端方式存放
	- 指令获取操作数的方式 **寻址方式**
	- 指令执行过程的控制方式，包括**程序计数器（PC）、条件码定义**等


# 数制的表示和编码

![[Pasted image 20230519210623.png]]

## 信息的二进制编码

**机器级数据分两大类**
- 数值数据：无符号整数、带符号整数、浮点数
- 非数值数据：逻辑数（包括**位串**：若干个01）、西文字符、汉字

**用二进制编码的原因：**
- 制造二个稳态的物理器件容易
- 二进制编码、技术、运算简单
- 与逻辑运算对应，便于逻辑运算
- 可方便地用逻辑电路实现算数运算

**真值和机器数**
- 机器数：编码以后地01序列
- 真值：现实中带正负号的数
——机器数机器认识，真值人认识

**数值数据表示的三要素：
- 进位计数制
	- 十、二、八、十六
- 定、浮点表示
	- 定点整数、定点小数
	- 浮点数
- 如何二进制编码
	- 原码、补码、反码、移码

**要确定一个数值数据的必须先确定这三个要素**

### R进位计数制
![[Pasted image 20230521172907.png]]
![[Pasted image 20230521172933.png]]

**小数点在计算机中如何表示？**
——计算机通过约定小数点的位置来表示

- 浮点数和定点数
	- 小数点位置约定在固定位置的数
	- 小数点位置约定为可浮动的数称为浮点数
![[Pasted image 20230521173624.png]]

#### 如何表示

- 原码
 ![[Pasted image 20230521173857.png]]

从50年代开始，整数都采用补码表示，但浮点数的尾数用原码定点小数表示

**译码表示**
——将每一个数值加上一个偏置常数
![[Pasted image 20230521174532.png]]

**补码**
![[Pasted image 20230521174903.png]]

![[Pasted image 20230521182148.png]]
#### 负数求补的一个简便方法
![[Pasted image 20230521183026.png]]
![[Pasted image 20230521183326.png]]


## C语言中的整数

![[Pasted image 20230521183717.png|400]]

整数分为：无符号和有符号

![[Pasted image 20230521185021.png|500]]
**计算机中常用第一种**

带符号数没有有符号数表示范围大（有一位需要用作符号位）

![[Pasted image 20230521190057.png]]

# IA-32指令系统

## 程序和指令的关系
——程序由指令组成，程序被启动后，计算机能自动取出指令执行，在执行过程中无需人的干预

**指令中需要给出的信息：**
- 操作码（操作性质）
- 原操作数（立即数、寄存器编号、存储地址）
- 目的操作数地址（寄存器编号、存储地址——

**存储地址的描述与操作数的数据结构有关！**

### 指令的概念
——有微指令、机器指令、伪指令之分

- 机器指令：处于硬件和软件的交界面
- 微指令：微程序级命令，属于硬件范畴
- 伪指令：由若干机器指令组成的指令序列，属于软件范畴
- 汇编指令：机器指令的符号表示   **二者一一对应**
![[Pasted image 20230523202109.png]]
——不同的机器的汇编指令不同

### GCC使用
![[Pasted image 20230523202559.png]]

——可以看到编译和反汇编的 汇编指令有一点区别

两种目标文件：
test   可执行目标文件
test.o   可重定位目标文件
![[Pasted image 20230523203000.png]]
两者的区别在于 **地址**

![[Pasted image 20230523203143.png]]


### ISA和计算机组成（微结构）的关系

## IA32-的指令系统概述

x86：是Intel开发的一类处理器体系结构的泛称

- 规定了8个寄存器 ，一个EFLAGS，PC为EIP
- 可寻址空间４GB
- 指令格式变长、操作码变长、指令由若干字段组成

![[Pasted image 20230523204535.png]]
EAX那一坨是扩展到32位之后多出来的

![[Pasted image 20230523204624.png]]

![[Pasted image 20230523204759.png]]
——TF用于单步跟踪　调试程序

### IA-32 的寻址方式

![[Pasted image 20230523205011.png]]
### IA-32机器指令格式

![[Pasted image 20230524150622.png|400]]
- 位移量和立即数都可以是 1、2、4字节
- SIB中基址B和变址I都可是8个GRS中任一个
	- ss给出比例因子（有四种情况1、2、4、8，分别对应char、short，int，double四种不同大小的数据，四种情况用2位就可以表示）
	- 
- 寻址方式：三个字段，分别表示寻址方式，寄存器编号/操作码的扩展字段，R/M模式位（确定是寄存器操作数还是存储器操作数）
- 操作码：就相当于命令的机器码

# IA-32指令类型

——会查手册，并能理解手册的解释

## 传送指令

### 通用数据传送指令

MOV  ：包括movb、movw movl  **要求变量等长**
MOVS   符号扩展传送 如 movsbw（8位传到16位）  movswl（2到4）
MOVZ    无符号扩展传送  如movzwl  movzbl
XCHG 数据交换
PUSH/POP 入栈/出栈   如pushl，pushw，popl，popw

**b、w、l后缀分别为8、16、32位**
### 地址传送指令

LEA ：加载有效地址 
如  
```
leal (%edx,%eax),%eax ;的功能为：R[eax]←R[edx]+[eax]
```
如果执行前R\[edx\]=i R \[eax\]=j  则执行指令后 R\[eax\]=i+j

### 输入输出指令

IN/OUT I/O端口与寄存器之间的交换

### 标志传送指令
PUSHF、POPF ：将EFLAG压栈，或将栈顶内容送至EFLAG

### 机器中指令的执行过程——以入栈为例

栈：采用先进后出方式进行访问的一块存储区，用于嵌套过程调用。**从高地址向低地址增长**





## 定点算数运算指令

ADD 加 包括addb addw addl 等
SUB 减  包括 subb subw subl

INC 增1 包括 incb incw incl
DEC 减1 包括的成本decw decl等

取负运算（影响标志、若对0取负，则结果为0且CF清0，否则CF置1
NEG 取负 包括 negb negw negl

比较运算（做减法得到标志，不区分无/带符号数）

CMP： 比较 如cmpb  cmpw cmpl

**乘法指令**

- 若给出一个操作数SRC，则另一个操作时隐含在AX中
（后续如果没做特殊说明，AX指代所有那几个位数不同的加法寄存器，包括AL，AX，EAX ）
- 两个操作数 DST SRC，则将两者相乘，结果放在DST中
- 若给出三个操作数 REG SRC IMM ，则将SRC和IMM相乘 结果放在REG中


### 加法运算的底层实现

**ALU中有哪些部件？**
- 补码加减器
	乘除法可以通过移位实现
- 各种逻辑部件（与门、或门、与非门）

**这个和微机原理是同一个汇编语言，就是格式不一样……格式不一样**

![[Pasted image 20230526155953.png]]

### 控制转移指令

JMP  无条件转移指令

Jcc DST  条件转移

SETcc  DST    条件设置　　按条件码cc判断的结果保存到DSY（一个8位寄存器）

CALL　DST　　返回地址RA入栈，转DST处执行
RET  从栈中取出返回地址RA，转到RA处执行

中断指令

![[Pasted image 20230526162630.png|500]]

### IA-32的浮点处理架构

**有两种**：
- x87FPU指令集（gcc默认）
- SSE指令集（x86-64架构所用）

![[Pasted image 20230526164600.png]]![[Pasted image 20230526164747.png]]![[Pasted image 20230526164757.png]]